# Singleton Pattern

- **Refactoring Guru â€“ Singleton Pattern**: [https://refactoring.guru/design-patterns/singleton](https://refactoring.guru/design-patterns/singleton)
- **Youtube - Singleton Pattern**: https://www.youtube.com/watch?v=tSZn4wkBIu8

#### 5.1. What is the Singleton Pattern?

> **Ensure a class has only one instance and provide a global point of access to it.**

Singleton restricts instantiation to a single object. Use sparingly; it's often considered an anti-pattern in large systems due to hidden global state.

#### 5.2. When (and when not) to use Singleton?

- Use for: configuration, logging sinks, device managers, caches
- Avoid when: testability matters, you need clear dependency injection, or concurrency/isolation is critical

#### 5.3. Python Implementations

1. Module-level (Pythonic, simplest)

```python
# settings.py
DB_URL = "postgres://..."
```

Importing module variables acts like a singleton.

2. **new** override

```python
import threading

class Singleton:
    _instance = None
    _lock = threading.Lock()
    def __new__(cls, *args, **kwargs):
        if not cls._instance:
            with cls._lock:
                if not cls._instance:
                    cls._instance = super().__new__(cls)
        return cls._instance
```

3. Decorator

```python
def singleton(cls):
    instances = {}
    def get_instance(*args, **kwargs):
        if cls not in instances:
            instances[cls] = cls(*args, **kwargs)
        return instances[cls]
    return get_instance

@singleton
class Cache:
    pass
```

4. Borg/Monostate (shared state)

```python
class Borg:
    _state = {}
    def __init__(self):
        self.__dict__ = self._state
```

#### 5.4. Thread Safety and Multiprocessing

- Use locks around first instantiation in multi-threaded contexts
- Across processes, OS-level singletons don't hold; use external coordination (files, sockets, DB)

#### 5.5. Advantages and Disadvantages of Singleton

| Advantage                | Description                   |
| ------------------------ | ----------------------------- |
| **Single access point**  | Centralize shared resource    |
| **Controlled lifecycle** | Lazily initialize when needed |

| Drawback                 | Explanation                       |
| ------------------------ | --------------------------------- |
| **Global state**         | Hinders testability and isolation |
| **Hidden dependencies**  | Harder to reason about            |
| **Concurrency pitfalls** | Race conditions without care      |

#### 5.6. Alternatives to Singleton

- Prefer dependency injection (pass instances explicitly)
- Use application context/container
- For constants, prefer module-level variables

